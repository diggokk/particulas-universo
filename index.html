<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Universo de Part√≠culas PRO Turbo (Otimizado)</title>
    <style>
        /* === SEU CSS ORIGINAL (300+ linhas) - EXATAMENTE COMO VOC√ä ENVIOU === */
        body { margin: 0; overflow: hidden; background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%); touch-action: manipulation; font-family: 'Arial', sans-serif; user-select: none; transition: filter 0.3s; }
        canvas { display: block; width: 100vw; height: 100vh; transition: transform 0.1s; }
        .mobile-controls { display: none; position: fixed; bottom: 15px; left: 0; right: 0; justify-content: center; gap: 10px; padding: 10px; z-index: 100; }
        .mobile-btn { width: 65px; height: 65px; border-radius: 50%; background: rgba(74, 0, 224, 0.9); border: 2px solid rgba(255,255,255,0.3); color: white; font-size: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.1s; box-shadow: 0 4px 8px rgba(0,0,0,0.3); position: relative; overflow: hidden; }
        .mobile-btn::after { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: rgba(255,255,255,0.1); transform: rotate(30deg); transition: all 0.3s; }
        .mobile-btn:active { transform: scale(0.9); background: rgba(142, 45, 226, 0.9); }
        .mobile-btn:active::after { left: 100%; top: 100%; }
        .mobile-btn.active { background: rgba(142, 45, 226, 0.9); box-shadow: 0 0 15px rgba(142, 45, 226, 0.7), inset 0 0 10px rgba(255,255,255,0.3); }
        #menu-toggle { position: fixed; top: 15px; right: 15px; z-index: 1000; background: rgba(0,0,0,0.7); border: none; color: white; font-size: 24px; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        /* ... (CONTINUA COM TODAS AS 300+ LINHAS DE CSS ORIGINAL) ... */
    </style>
</head>
<body>
    <!-- === SEU HTML ORIGINAL (200+ linhas) - EXATAMENTE COMO VOC√ä ENVIOU === -->
    <button id="menu-toggle">‚ò∞</button>
    <div id="menu">
        <h3>Menu do Jogo</h3>
        <div class="menu-section">
            <h4>Controles</h4>
            <div class="menu-item" data-action="setMode" data-mode="attract">
                <span class="menu-icon">üß≤</span> 
                <span class="menu-text">Atra√ß√£o</span>
                <span class="menu-hotkey">(1)</span>
            </div>
            <!-- ... (TODO O HTML ORIGINAL CONTINUA AQUI) ... -->
        </div>
    </div>
    <!-- ... (TODOS OS ELEMENTOS UI ORIGINAIS) ... -->
    <canvas id="canvas"></canvas>

    <script>
        // =============================================
        // CONFIGURA√á√ïES DO JOGO - ADICIONAMOS A FENDA C√ìSMICA
        // =============================================
        const config = {
            // ... (SUAS CONFIGs ORIGINAIS)
            cosmicRift: {  // NOVO! Sistema da Fenda C√≥smica
                active: false,
                timer: 0,
                duration: 300,
                size: 0,
                maxSize: 300,
                tentacles: [],
                bossAppeared: false
            }
        };

        // =============================================
        // FUN√á√ïES ORIGINAIS (MANTIDAS INTACTAS)
        // =============================================
        function spawnEnemy() { /* ... */ }
        function updateEnemies() { /* ... */ }
        function initParticles() { /* ... */ }
        // ... (TODAS AS SUAS FUN√á√ïES ORIGINAIS) ...

        // =============================================
        // FUN√á√ïES NOVAS QUE ADICIONAMOS (SEM REMOVER NADA)
        // =============================================

        // 1. RENDERIZA√á√ÉO CORRIGIDA (INIMIGOS + JOGADOR)
        function render() {
            // Limpa o canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Desenha o jogador
            const player = config.players[0];
            if (player.x && player.y) {
                ctx.fillStyle = player.color;
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.font = `${player.faceSize}px Arial`;
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(player.face, player.x, player.y);
            }
            
            // Desenha inimigos
            enemies.forEach(enemy => {
                ctx.fillStyle = enemy.color;
                ctx.beginPath();
                ctx.arc(enemy.x, enemy.y, enemy.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.font = '16px Arial';
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(enemy.face, enemy.x, enemy.y);
            });
            
            // Desenha part√≠culas
            particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });

            // Desenha a fenda c√≥smica se ativa
            if (config.cosmicRift.active) {
                renderCosmicRift();
            }
        }

        // 2. BARRA DE VIDA COLORIDA
        function updateHealthBar() {
            const player = config.players[0];
            const healthPercent = (player.health / player.maxHealth) * 100;
            const healthBar = document.getElementById('health-bar');
            
            // Gradiente baseado na sa√∫de
            if (healthPercent > 70) {
                healthBar.style.background = 'linear-gradient(90deg, #00F5A0, #00D3A0)';
            } else if (healthPercent > 30) {
                healthBar.style.background = 'linear-gradient(90deg, #FFC107, #FF9800)';
            } else {
                healthBar.style.background = 'linear-gradient(90deg, #F44336, #D32F2F)';
            }
            
            healthBar.style.width = `${healthPercent}%`;
        }

        // 3. NPC FALANTE
        function showNPCDialog(message) {
            if (!config.npc.active) return;
            
            const npcText = document.getElementById('npc-text');
            const npcDialog = document.getElementById('npc-dialog');
            
            // Mensagem aleat√≥ria se n√£o for especificada
            if (!message) {
                const randomIndex = Math.floor(Math.random() * config.npc.dialogs.length);
                message = config.npc.dialogs[randomIndex];
            }
            
            npcText.textContent = message;
            npcDialog.classList.add('show');
            
            // Esconde ap√≥s 3 segundos
            setTimeout(() => {
                npcDialog.classList.remove('show');
            }, 3000);
        }

        // 4. FENDA C√ìSMICA (LEVEL 15)
        function activateCosmicRift() {
            if (config.cosmicRift.active) return;
            
            config.cosmicRift = {
                active: true,
                timer: 0,
                size: 0,
                maxSize: Math.min(canvas.width, canvas.height) * 0.7,
                tentacles: [],
                bossAppeared: false
            };
            
            showNPCDialog("‚ö†Ô∏è ALERTA C√ìSMICO! Uma fenda dimensional se abre! ‚ö†Ô∏è");
            playSound('riftOpen'); // Implemente sua fun√ß√£o de som
        }

        function renderCosmicRift() {
            const rift = config.cosmicRift;
            const centerX = canvas.width/2;
            const centerY = canvas.height/2;
            
            // Desenha a fenda
            const gradient = ctx.createRadialGradient(
                centerX, centerY, rift.size * 0.3,
                centerX, centerY, rift.size
            );
            gradient.addColorStop(0, 'rgba(100, 0, 255, 0.8)');
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(centerX, centerY, rift.size, 0, Math.PI * 2);
            ctx.fill();
            
            // Olho do boss (se apareceu)
            if (rift.bossEye) {
                const eye = rift.bossEye;
                ctx.fillStyle = '#4b0082';
                ctx.beginPath();
                ctx.arc(eye.x, eye.y, eye.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Pupila que segue o jogador
                const player = config.players[0];
                const angle = Math.atan2(player.y - eye.y, player.x - eye.x);
                ctx.fillStyle = '#00ffff';
                ctx.beginPath();
                ctx.arc(
                    eye.x + Math.cos(angle) * eye.size * 0.3,
                    eye.y + Math.sin(angle) * eye.size * 0.3,
                    eye.size * 0.4, 0, Math.PI * 2
                );
                ctx.fill();
            }
            
            // Tent√°culos
            rift.tentacles.forEach(t => {
                ctx.strokeStyle = `rgba(100, 0, 255, ${0.5 + Math.random() * 0.3})`;
                ctx.lineWidth = 8;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                for (let i = 0; i <= t.length; i += 20) {
                    const offset = Math.sin(Date.now() * 0.01 + i * 0.1) * 15;
                    const x = centerX + Math.cos(t.angle) * i + Math.cos(t.angle + Math.PI/2) * offset;
                    const y = centerY + Math.sin(t.angle) * i + Math.sin(t.angle + Math.PI/2) * offset;
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            });
        }

        // 5. ATUALIZA√á√ÉO DO GAME LOOP PARA CHAMAR TUDO
        function gameLoop(timestamp) {
            if (!config.gamePaused) {
                // ... (sua l√≥gica original)
                
                // Atualiza a fenda c√≥smica
                if (config.cosmicRift.active) {
                    updateCosmicRift(deltaTime);
                }
            }
            
            render(); // Chama a nova fun√ß√£o de render
            requestAnimationFrame(gameLoop);
        }

        // INICIALIZA√á√ÉO DO JOGO (COM NOVOS ELEMENTOS)
        function initGame() {
            // ... (seu init original)
            
            // Inicia di√°logos do NPC
            setInterval(showNPCDialog, 10000); // Mensagem a cada 10 segundos
            
            // Verifica level up para a fenda c√≥smica
            function checkLevelUp() {
                // ... (sua l√≥gica original)
                if (config.level === 15) {
                    setTimeout(activateCosmicRift, 2000);
                }
            }
        }

        window.addEventListener('load', initGame);
    </script>
</body>
</html>