<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universo de Part√≠culas PRO Turbo - Edi√ß√£o Definitiva PLUS</title>
    <style>
        /* [Seu CSS original permanece EXATAMENTE igual] */
        body {
            margin: 0;
            overflow: hidden;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            touch-action: manipulation;
            font-family: Arial, sans-serif;
        }

        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        .mobile-controls {
            display: none;
            position: fixed;
            bottom: 15px;
            left: 0;
            right: 0;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            z-index: 100;
        }

        /* [...] (Todo o seu CSS original permanece aqui) */

        /* NOVOS ESTILOS ADICIONADOS */
        .mission-container {
            position: fixed;
            top: 60px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
            max-width: 250px;
            border-left: 3px solid #00F5A0;
        }

        .mission-title {
            color: #00F5A0;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mission-progress {
            height: 5px;
            background: rgba(255,255,255,0.2);
            margin-top: 5px;
            border-radius: 3px;
            overflow: hidden;
        }

        .mission-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4A00E0, #8E2DE2);
            width: 0%;
        }

        .boss-health-container {
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            height: 20px;
            background: rgba(0,0,0,0.7);
            z-index: 100;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }

        .boss-health-bar {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, #FF0000, #FF4500);
            transition: width 0.3s;
        }

        .boss-name {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-weight: bold;
            text-shadow: 0 0 5px black;
            font-size: 14px;
        }

        .story-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s;
        }

        .story-text {
            max-width: 600px;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .continue-btn {
            background: linear-gradient(90deg, #4A00E0, #8E2DE2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }

        .ability-cooldown {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .ability-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(0,0,0,0.7);
            border: 2px solid rgba(255,255,255,0.2);
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
        }

        .ability-btn:active {
            transform: scale(0.9);
        }

        .ability-btn .cooldown-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            height: 0%;
            transition: height 0.1s;
        }

        #bigbang-btn-new {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(255, 0, 255, 0.7);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
        }

        #bigbang-btn-new:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #bigbang-btn-new .cooldown-text {
            position: absolute;
            bottom: -20px;
            font-size: 12px;
            color: white;
            text-shadow: 0 0 3px black;
        }

        .freeze-effect {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(173, 216, 230, 0.3);
            pointer-events: none;
            z-index: 999;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .teleport-effect {
            position: absolute;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(255,255,255,0.8), transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 998;
            transform: scale(0);
            opacity: 0;
        }

        .clone-indicator {
            position: absolute;
            width: 30px;
            height: 30px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            border: 2px dashed white;
            z-index: 10;
        }

        @media (max-width: 768px) {
            .ability-cooldown {
                bottom: 150px;
            }
            
            .ability-btn {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            #bigbang-btn-new {
                width: 60px;
                height: 60px;
                font-size: 20px;
                bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- [Seu HTML original permanece EXATAMENTE igual] -->
    <button id="menu-toggle">‚ò∞</button>
    <div id="menu">
        <h3>Menu do Jogo</h3>
        <!-- [...] (Todo o seu HTML original permanece aqui) -->
    </div>

    <!-- Bot√£o Big Bang Original (mantido para compatibilidade) -->
    <div id="bigbang-btn" title="Big Bang (Espa√ßo)">üí•</div>
    
    <!-- Novo Bot√£o Big Bang Centralizado -->
    <button id="bigbang-btn-new" title="Big Bang (Dispon√≠vel a cada 15 n√≠veis)">
        üí•
        <span class="cooldown-text"></span>
    </button>

    <!-- Novos Controles de Habilidade -->
    <div class="ability-cooldown">
        <button class="ability-btn" id="teleport-btn" title="Teletransporte (T)">üöÄ</button>
        <button class="ability-btn" id="freeze-btn" title="Congelamento (F)">‚ùÑÔ∏è</button>
        <button class="ability-btn" id="clone-btn" title="Clone C√≥smico (C)">üë•</button>
    </div>

    <!-- Efeitos Visuais -->
    <div class="freeze-effect" id="freeze-effect"></div>
    <div class="teleport-effect" id="teleport-effect"></div>

    <!-- Miss√µes -->
    <div class="mission-container" id="mission-container">
        <div class="mission-title" id="mission-title">Miss√£o Di√°ria</div>
        <div id="mission-description">Absorva 50 part√≠culas</div>
        <div class="mission-progress">
            <div class="mission-progress-bar" id="mission-progress-bar"></div>
        </div>
    </div>

    <!-- Barra de Vida do Boss -->
    <div class="boss-health-container" id="boss-health-container">
        <div class="boss-health-bar" id="boss-health-bar"></div>
        <div class="boss-name" id="boss-name">N√∫cleo do Caos</div>
    </div>

    <!-- Hist√≥ria -->
    <div class="story-overlay" id="story-overlay">
        <div class="story-text" id="story-text">
            No alvorecer do universo, voc√™ era uma entidade primordial - um Deus das Part√≠culas que mantinha o equil√≠brio c√≥smico. 
            Mas uma cat√°strofe desconhecida fragmentou seu poder, espalhando suas energias por gal√°xias distantes.
            
            Agora, voc√™ deve recuperar seu poder, absorvendo part√≠culas elementares e enfrentando as entidades ca√≥ticas que surgiram 
            no v√°cuo do seu desaparecimento.
            
            O destino do multiverso est√° em suas m√£os...
        </div>
        <button class="continue-btn" id="continue-btn">Come√ßar Jornada</button>
    </div>

    <!-- [Restante do seu HTML original permanece aqui] -->

    <script>
        // [Seu c√≥digo original permanece EXATAMENTE igual at√© a linha onde come√ßa o objeto config]
        // Configura√ß√µes do jogo
        const config = {
            particleCount: 200,
            mouseRadius: 150,
            mode: 'normal',
            galaxies: {
                unlocked: ['classic'],
                current: 'classic'
            },
            xp: 0,
            level: 1,
            power: 1,
            health: 100,
            maxHealth: 100,
            bigBangCooldown: 0,
            bigBangMaxCooldown: 300,
            isBigBangActive: false,
            players: [
                {
                    id: 1,
                    x: null,
                    y: null,
                    mode: 'normal',
                    color: '#4A00E0',
                    radius: 150,
                    power: 1,
                    health: 100,
                    face: "üê∂",
                    active: true
                },
                {
                    id: 2,
                    x: null,
                    y: null,
                    mode: 'normal',
                    color: '#00F5A0',
                    radius: 150,
                    power: 1,
                    health: 100,
                    face: "üê±",
                    active: false
                }
            ],
            coopMode: false,
            achievements: {
                particleEater: { unlocked: false, count: 0, required: 50 },
                galaxyExplorer: { unlocked: false, count: 0, required: 3 },
                enemyDestroyer: { unlocked: false, count: 0, required: 100 }
            },
            skills: [
                { id: 'attract_radius', name: "Raio Ampliado", level: 0, max: 5, effect: "Aumenta o raio de atra√ß√£o em 20%", cost: 2, unlocked: true },
                { id: 'vortex_power', name: "V√≥rtice Poderoso", level: 0, max: 3, effect: "Aumenta for√ßa do v√≥rtice em 30%", cost: 3 },
                { id: 'double_vortex', name: "V√≥rtice Duplo", level: 0, max: 1, effect: "Cria um segundo v√≥rtice", cost: 5 },
                { id: 'health_boost', name: "Vitalidade", level: 0, max: 3, effect: "Aumenta vida m√°xima em 15%", cost: 2 },
                { id: 'bigbang_power', name: "Big Bang+", level: 0, max: 2, effect: "Aumenta poder do Big Bang", cost: 4 }
            ],
            currentMission: null,
            missionProgress: 0,
            wave: {
                number: 1,
                enemiesToSpawn: 5,
                spawned: 0,
                timer: 0
            },
            particlesAbsorbed: 0,
            enemiesDestroyed: 0,
            gameTime: 0,
            isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
        };

        // =============================================
        // NOVAS ADI√á√ïES (sem alterar o c√≥digo original)
        // =============================================

        // Configura√ß√µes estendidas
        config.bigBangLevelRequirement = 15;
        config.lastBigBangLevel = 0;
        config.abilities = {
            teleport: { cooldown: 0, maxCooldown: 300, active: false },
            freeze: { cooldown: 0, maxCooldown: 600, active: false, duration: 180 },
            clone: { cooldown: 0, maxCooldown: 450, active: false, duration: 300 }
        };
        config.clones = [];
        config.activeBoss = null;
        config.storyShown = false;
        config.dailyMissions = [
            { 
                title: "Colecionador de Part√≠culas", 
                description: "Absorva 50 part√≠culas", 
                type: "absorb", 
                target: 50, 
                reward: 100 
            },
            { 
                title: "Ca√ßador de Inimigos", 
                description: "Destrua 15 inimigos", 
                type: "enemies", 
                target: 15, 
                reward: 150 
            },
            { 
                title: "Mestre do V√≥rtice", 
                description: "Use o v√≥rtice por 30 segundos", 
                type: "vortex", 
                target: 1800, // 30 segundos em frames (60fps)
                reward: 120 
            }
        ];
        config.currentMission = null;
        config.missionProgress = 0;
        config.vortexTime = 0;

        // Inicializa√ß√£o das novas funcionalidades
        function initNewFeatures() {
            // Configurar miss√£o di√°ria aleat√≥ria
            if (!config.currentMission) {
                const randomMission = config.dailyMissions[Math.floor(Math.random() * config.dailyMissions.length)];
                config.currentMission = {...randomMission, progress: 0};
                updateMissionUI();
            }

            // Mostrar hist√≥ria apenas uma vez
            if (!config.storyShown) {
                setTimeout(() => {
                    document.getElementById('story-overlay').style.opacity = '1';
                    document.getElementById('story-overlay').style.pointerEvents = 'auto';
                    config.storyShown = true;
                }, 1000);
            }

            // Configurar eventos dos novos bot√µes
            document.getElementById('continue-btn').addEventListener('click', () => {
                document.getElementById('story-overlay').style.opacity = '0';
                document.getElementById('story-overlay').style.pointerEvents = 'none';
            });

            document.getElementById('teleport-btn').addEventListener('click', activateTeleport);
            document.getElementById('freeze-btn').addEventListener('click', activateFreeze);
            document.getElementById('clone-btn').addEventListener('click', activateClone);
            document.getElementById('bigbang-btn-new').addEventListener('click', activateNewBigBang);

            // Verificar se o Big Bang est√° dispon√≠vel
            updateBigBangButton();
        }

        // Atualizar UI da miss√£o
        function updateMissionUI() {
            if (config.currentMission) {
                document.getElementById('mission-title').textContent = config.currentMission.title;
                document.getElementById('mission-description').textContent = config.currentMission.description;
                const progressPercent = (config.currentMission.progress / config.currentMission.target) * 100;
                document.getElementById('mission-progress-bar').style.width = `${Math.min(100, progressPercent)}%`;
            }
        }

        // Completar miss√£o
        function completeMission() {
            if (config.currentMission) {
                addXP(config.currentMission.reward);
                showUnlockMessage(`Miss√£o completa! +${config.currentMission.reward} XP`);
                
                // Escolher nova miss√£o
                const randomMission = config.dailyMissions[Math.floor(Math.random() * config.dailyMissions.length)];
                config.currentMission = {...randomMission, progress: 0};
                updateMissionUI();
            }
        }

        // Ativar teletransporte
        function activateTeleport() {
            if (config.abilities.teleport.cooldown <= 0 && particles.length > 0) {
                // Encontrar a part√≠cula mais pr√≥xima
                let closestParticle = null;
                let minDistance = Infinity;
                
                particles.forEach(p => {
                    const dx = p.x - (config.players[0].x || canvas.width/2);
                    const dy = p.y - (config.players[0].y || canvas.height/2);
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestParticle = p;
                    }
                });
                
                if (closestParticle) {
                    // Efeito visual
                    const effect = document.getElementById('teleport-effect');
                    effect.style.left = `${config.players[0].x || canvas.width/2 - 50}px`;
                    effect.style.top = `${config.players[0].y || canvas.height/2 - 50}px`;
                    effect.style.opacity = '1';
                    effect.style.transform = 'scale(1)';
                    
                    setTimeout(() => {
                        effect.style.transform = 'scale(0)';
                        effect.style.opacity = '0';
                        
                        // Teleportar
                        config.players[0].x = closestParticle.x;
                        config.players[0].y = closestParticle.y;
                        
                        // Remover a part√≠cula
                        particles.splice(particles.indexOf(closestParticle), 1);
                        
                        // Efeito no destino
                        effect.style.left = `${config.players[0].x - 50}px`;
                        effect.style.top = `${config.players[0].y - 50}px`;
                        effect.style.opacity = '1';
                        effect.style.transform = 'scale(1)';
                        
                        setTimeout(() => {
                            effect.style.transform = 'scale(0)';
                            effect.style.opacity = '0';
                        }, 300);
                    }, 300);
                    
                    config.abilities.teleport.cooldown = config.abilities.teleport.maxCooldown;
                    updateAbilityButtons();
                }
            }
        }

        // Ativar congelamento
        function activateFreeze() {
            if (config.abilities.freeze.cooldown <= 0) {
                config.abilities.freeze.active = true;
                config.abilities.freeze.cooldown = config.abilities.freeze.maxCooldown;
                config.abilities.freeze.durationLeft = config.abilities.freeze.duration;
                
                // Efeito visual
                document.getElementById('freeze-effect').style.opacity = '0.3';
                
                // Congelar part√≠culas e inimigos
                particles.forEach(p => {
                    p.frozenSpeedX = p.speedX;
                    p.frozenSpeedY = p.speedY;
                    p.speedX = 0;
                    p.speedY = 0;
                });
                
                enemies.forEach(e => {
                    e.frozenSpeedX = e.speedX;
                    e.frozenSpeedY = e.speedY;
                    e.speedX = 0;
                    e.speedY = 0;
                });
                
                updateAbilityButtons();
            }
        }

        // Desativar congelamento
        function deactivateFreeze() {
            config.abilities.freeze.active = false;
            document.getElementById('freeze-effect').style.opacity = '0';
            
            // Descongelar part√≠culas e inimigos
            particles.forEach(p => {
                if (p.frozenSpeedX !== undefined) {
                    p.speedX = p.frozenSpeedX;
                    p.speedY = p.frozenSpeedY;
                    delete p.frozenSpeedX;
                    delete p.frozenSpeedY;
                }
            });
            
            enemies.forEach(e => {
                if (e.frozenSpeedX !== undefined) {
                    e.speedX = e.frozenSpeedX;
                    e.speedY = e.frozenSpeedY;
                    delete e.frozenSpeedX;
                    delete e.frozenSpeedY;
                }
            });
        }

        // Ativar clone c√≥smico
        function activateClone() {
            if (config.abilities.clone.cooldown <= 0) {
                const player = config.players[0];
                if (player.x && player.y) {
                    // Criar clone
                    const clone = {
                        x: player.x + (Math.random() * 200 - 100),
                        y: player.y + (Math.random() * 200 - 100),
                        radius: player.radius * 0.8,
                        color: player.color,
                        mode: 'attract',
                        duration: config.abilities.clone.duration,
                        power: player.power * 0.7
                    };
                    
                    // Garantir que o clone fique na tela
                    clone.x = Math.max(clone.radius, Math.min(canvas.width - clone.radius, clone.x));
                    clone.y = Math.max(clone.radius, Math.min(canvas.height - clone.radius, clone.y));
                    
                    config.clones.push(clone);
                    config.abilities.clone.cooldown = config.abilities.clone.maxCooldown;
                    updateAbilityButtons();
                    
                    // Efeito visual
                    const indicator = document.createElement('div');
                    indicator.className = 'clone-indicator';
                    indicator.style.left = `${clone.x - 15}px`;
                    indicator.style.top = `${clone.y - 15}px`;
                    indicator.id = `clone-${config.clones.length - 1}`;
                    document.body.appendChild(indicator);
                }
            }
        }

        // Atualizar clones
        function updateClones() {
            for (let i = config.clones.length - 1; i >= 0; i--) {
                const clone = config.clones[i];
                clone.duration--;
                
                // Atualizar posi√ß√£o do indicador
                const indicator = document.getElementById(`clone-${i}`);
                if (indicator) {
                    indicator.style.left = `${clone.x - 15}px`;
                    indicator.style.top = `${clone.y - 15}px`;
                }
                
                // Aplicar efeito do clone nas part√≠culas
                particles.forEach(p => {
                    const dx = clone.x - p.x;
                    const dy = clone.y - p.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < clone.radius) {
                        const force = (clone.radius - distance) / clone.radius;
                        p.speedX += dx * 0.05 * force * clone.power;
                        p.speedY += dy * 0.05 * force * clone.power;
                        
                        if (distance < clone.radius * 0.2) {
                            particles.splice(particles.indexOf(p), 1);
                            addXP(2); // XP reduzido para clones
                        }
                    }
                });
                
                // Remover clone quando o tempo acabar
                if (clone.duration <= 0) {
                    config.clones.splice(i, 1);
                    if (indicator) {
                        indicator.remove();
                    }
                }
            }
        }

        // Desenhar clones
        function drawClones() {
            config.clones.forEach(clone => {
                ctx.fillStyle = clone.color + '40';
                ctx.beginPath();
                ctx.arc(clone.x, clone.y, clone.radius, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = clone.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(clone.x, clone.y, clone.radius, 0, Math.PI * 2);
                ctx.stroke();
                
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('üß≤', clone.x, clone.y);
            });
        }

        // Atualizar bot√µes de habilidade
        function updateAbilityButtons() {
            const abilities = ['teleport', 'freeze', 'clone'];
            
            abilities.forEach(ability => {
                const btn = document.getElementById(`${ability}-btn`);
                const cooldown = config.abilities[ability].cooldown;
                const maxCooldown = config.abilities[ability].maxCooldown;
                
                if (cooldown > 0) {
                    const percent = (1 - (cooldown / maxCooldown)) * 100;
                    btn.style.opacity = '0.7';
                    btn.querySelector('.cooldown-overlay').style.height = `${100 - percent}%`;
                } else {
                    btn.style.opacity = '1';
                    btn.querySelector('.cooldown-overlay').style.height = '0%';
                }
                
                if (config.abilities[ability].active) {
                    btn.style.boxShadow = '0 0 15px #00FFFF';
                } else {
                    btn.style.boxShadow = 'none';
                }
            });
        }

        // Atualizar bot√£o do Big Bang
        function updateBigBangButton() {
            const btn = document.getElementById('bigbang-btn-new');
            const canUse = config.level >= config.lastBigBangLevel + config.bigBangLevelRequirement;
            
            if (canUse) {
                btn.disabled = false;
                btn.title = "Big Bang (Dispon√≠vel)";
                btn.querySelector('.cooldown-text').textContent = "PRONTO";
            } else {
                btn.disabled = true;
                const levelsNeeded = (config.lastBigBangLevel + config.bigBangLevelRequirement) - config.level;
                btn.title = `Big Bang (Dispon√≠vel em ${levelsNeeded} n√≠veis)`;
                btn.querySelector('.cooldown-text').textContent = `N√çVEL ${config.lastBigBangLevel + config.bigBangLevelRequirement}`;
            }
        }

        // Novo Big Bang real√≠stico
        function activateNewBigBang() {
            if (config.level >= config.lastBigBangLevel + config.bigBangLevelRequirement) {
                config.lastBigBangLevel = config.level;
                updateBigBangButton();
                
                // Efeito visual expansivo
                const bang = document.createElement('div');
                bang.style.position = 'fixed';
                bang.style.left = '0';
                bang.style.top = '0';
                bang.style.width = '100%';
                bang.style.height = '100%';
                bang.style.background = 'radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,0,255,0) 70%)';
                bang.style.zIndex = '1000';
                bang.style.pointerEvents = 'none';
                bang.style.opacity = '0';
                bang.style.transition = 'opacity 1.5s, transform 1.5s';
                bang.style.transform = 'scale(0.1)';
                document.body.appendChild(bang);
                
                setTimeout(() => {
                    bang.style.opacity = '1';
                    bang.style.transform = 'scale(1.5)';
                }, 10);
                
                setTimeout(() => {
                    bang.style.opacity = '0';
                    setTimeout(() => bang.remove(), 1500);
                }, 500);
                
                // Criar explos√£o de part√≠culas
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                // Remover todas as part√≠culas existentes
                particles = [];
                
                // Criar novas part√≠culas em padr√£o expansivo
                for (let i = 0; i < 500; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 5 + Math.random() * 10;
                    
                    particles.push({
                        x: centerX,
                        y: centerY,
                        size: Math.random() * 5 + 2,
                        color: `hsl(${Math.random() * 360}, 100%, 70%)`,
                        speedX: Math.cos(angle) * speed,
                        speedY: Math.sin(angle) * speed,
                        baseSpeedX: 0,
                        baseSpeedY: 0,
                        life: 200 + Math.random() * 100,
                        trail: []
                    });
                }
                
                // Danos aos inimigos
                enemies.forEach(enemy => {
                    // Calcular dist√¢ncia do centro
                    const dx = enemy.x - centerX;
                    const dy = enemy.y - centerY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    // Dano baseado na dist√¢ncia (mais perto = mais dano)
                    const damage = 50 * (1 - Math.min(1, distance / (canvas.width / 2)));
                    enemy.health -= damage;
                    
                    // Empurrar inimigos
                    if (distance > 0) {
                        const angle = Math.atan2(dy, dx);
                        const force = 20 * (1 - Math.min(1, distance / (canvas.width / 2)));
                        enemy.speedX += Math.cos(angle) * force;
                        enemy.speedY += Math.sin(angle) * force;
                    }
                });
                
                // Adicionar XP pelo Big Bang
                addXP(200);
                
                // Atualizar UI
                showUnlockMessage("BIG BANG ATIVADO! O universo recome√ßa...");
            }
        }

        // Spawnar boss
        function spawnBoss() {
            if (config.level % 5 === 0 && !config.activeBoss) {
                config.activeBoss = {
                    name: ["N√∫cleo do Caos", "Abismo Estelar", "Devorador de Gal√°xias"][Math.floor(Math.random() * 3)],
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    size: 80 + config.level * 5,
                    health: 200 + config.level * 50,
                    maxHealth: 200 + config.level * 50,
                    speed: 1 + config.level * 0.1,
                    phase: 1,
                    attackTimer: 0,
                    attackPattern: Math.floor(Math.random() * 3)
                };
                
                // Mostrar barra de vida do boss
                document.getElementById('boss-name').textContent = config.activeBoss.name;
                document.getElementById('boss-health-container').style.display = 'block';
                updateBossHealthBar();
                
                showUnlockMessage(`ALERTA: ${config.activeBoss.name} APARECEU!`);
            }
        }

        // Atualizar boss
        function updateBoss() {
            if (config.activeBoss) {
                const boss = config.activeBoss;
                
                // Movimento baseado no padr√£o de ataque
                boss.attackTimer++;
                
                switch (boss.attackPattern) {
                    case 0: // Circular
                        boss.x = canvas.width/2 + Math.cos(boss.attackTimer * 0.02) * (canvas.width/3);
                        boss.y = canvas.height/2 + Math.sin(boss.attackTimer * 0.02) * (canvas.height/3);
                        break;
                        
                    case 1: // Persegui√ß√£o
                        const player = config.players[0];
                        if (player.x && player.y) {
                            const dx = player.x - boss.x;
                            const dy = player.y - boss.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance > 100) {
                                boss.x += (dx / distance) * boss.speed;
                                boss.y += (dy / distance) * boss.speed;
                            }
                        }
                        break;
                        
                    case 2: // Teleportes aleat√≥rios
                        if (boss.attackTimer % 120 === 0) {
                            boss.x = Math.random() * (canvas.width - 200) + 100;
                            boss.y = Math.random() * (canvas.height - 200) + 100;
                        }
                        break;
                }
                
                // Ataques especiais
                if (boss.attackTimer % 180 === 0) {
                    // Ataque de explos√£o
                    for (let i = 0; i < 20; i++) {
                        const angle = Math.random() * Math.PI * 2;
                        const speed = 3 + Math.random() * 2;
                        
                        particles.push({
                            x: boss.x,
                            y: boss.y,
                            size: Math.random() * 6 + 3,
                            color: 'red',
                            speedX: Math.cos(angle) * speed,
                            speedY: Math.sin(angle) * speed,
                            baseSpeedX: 0,
                            baseSpeedY: 0,
                            life: 120,
                            trail: [],
                            enemyParticle: true
                        });
                    }
                }
                
                // Verificar colis√£o com jogador
                config.players.forEach(player => {
                    if (player.active && player.x && player.y) {
                        const dx = player.x - boss.x;
                        const dy = player.y - boss.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < boss.size/2 + 20) {
                            player.health -= 1;
                            updateHealthBar();
                            
                            // Efeito visual
                            document.body.style.boxShadow = 'inset 0 0 30px red';
                            setTimeout(() => {
                                document.body.style.boxShadow = 'none';
                            }, 100);
                        }
                    }
                });
                
                // Verificar se o boss morreu
                if (boss.health <= 0) {
                    createExplosion(boss.x, boss.y, boss.size * 2);
                    addXP(500 + config.level * 50);
                    showUnlockMessage(`${boss.name} derrotado! +${500 + config.level * 50} XP`);
                    config.activeBoss = null;
                    document.getElementById('boss-health-container').style.display = 'none';
                    
                    // Recompensa especial a cada 10 n√≠veis
                    if (config.level % 10 === 0) {
                        showUnlockMessage("RECOMPENSA: Habilidade especial desbloqueada!");
                        // Aqui voc√™ poderia desbloquear uma habilidade especial
                    }
                }
                
                updateBossHealthBar();
            }
        }

        // Atualizar barra de vida do boss
        function updateBossHealthBar() {
            if (config.activeBoss) {
                const percent = (config.activeBoss.health / config.activeBoss.maxHealth) * 100;
                document.getElementById('boss-health-bar').style.width = `${percent}%`;
            }
        }

        // Desenhar boss
        function drawBoss() {
            if (config.activeBoss) {
                const boss = config.activeBoss;
                
                // Corpo do boss
                const gradient = ctx.createRadialGradient(
                    boss.x, boss.y, boss.size * 0.3,
                    boss.x, boss.y, boss.size
                );
                
                gradient.addColorStop(0, 'rgba(255, 0, 0, 0.9)');
                gradient.addColorStop(0.5, 'rgba(100, 0, 100, 0.8)');
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0.8)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(boss.x, boss.y, boss.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Olhos
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(boss.x - boss.size * 0.3, boss.y - boss.size * 0.2, boss.size * 0.1, 0, Math.PI * 2);
                ctx.arc(boss.x + boss.size * 0.3, boss.y - boss.size * 0.2, boss.size * 0.1, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'red';
                ctx.beginPath();
                ctx.arc(boss.x - boss.size * 0.3, boss.y - boss.size * 0.2, boss.size * 0.05, 0, Math.PI * 2);
                ctx.arc(boss.x + boss.size * 0.3, boss.y - boss.size * 0.2, boss.size * 0.05, 0, Math.PI * 2);
                ctx.fill();
                
                // Boca
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(boss.x, boss.y + boss.size * 0.2, boss.size * 0.3, 0.1 * Math.PI, 0.9 * Math.PI);
                ctx.stroke();
            }
        }

        // Atualizar cooldowns
        function updateCooldowns() {
            // Atualizar cooldowns das habilidades
            Object.keys(config.abilities).forEach(ability => {
                if (config.abilities[ability].cooldown > 0) {
                    config.abilities[ability].cooldown--;
                }
            });
            
            // Atualizar dura√ß√£o do congelamento
            if (config.abilities.freeze.active) {
                config.abilities.freeze.durationLeft--;
                if (config.abilities.freeze.durationLeft <= 0) {
                    deactivateFreeze();
                }
            }
            
            updateAbilityButtons();
        }

        // Verificar miss√µes
        function checkMissions() {
            if (config.currentMission) {
                switch (config.currentMission.type) {
                    case 'absorb':
                        // J√° √© atualizado quando part√≠culas s√£o absorvidas
                        break;
                    case 'enemies':
                        // Atualizado quando inimigos s√£o destru√≠dos
                        break;
                    case 'vortex':
                        if (config.players[0].mode === 'vortex') {
                            config.currentMission.progress++;
                            if (config.currentMission.progress >= config.currentMission.target) {
                                completeMission();
                            }
                        }
                        break;
                }
                
                updateMissionUI();
            }
        }

        // Modifica√ß√£o na fun√ß√£o addXP para rastrear miss√µes
        const originalAddXP = addXP;
        addXP = function(amount) {
            originalAddXP.call(this, amount);
            
            if (config.currentMission && config.currentMission.type === 'absorb') {
                config.currentMission.progress++;
                if (config.currentMission.progress >= config.currentMission.target) {
                    completeMission();
                }
            }
        };

        // Modifica√ß√£o na destrui√ß√£o de inimigos para rastrear miss√µes
        enemies.forEach((enemy, index) => {
            if (enemy.health <= 0) {
                // [...] (c√≥digo original)
                
                if (config.currentMission && config.currentMission.type === 'enemies') {
                    config.currentMission.progress++;
                    if (config.currentMission.progress >= config.currentMission.target) {
                        completeMission();
                    }
                }
            }
        });

        // Modifica√ß√£o no loop principal para incluir novas funcionalidades
        const originalAnimate = animate;
        animate = function() {
            originalAnimate.call(this);
            
            // Atualizar novas funcionalidades
            updateCooldowns();
            updateClones();
            
            // Spawnar boss em n√≠veis espec√≠ficos
            if (config.level % 5 === 0 && !config.activeBoss && config.wave.number > 1) {
                spawnBoss();
            }
            
            // Atualizar boss se existir
            if (config.activeBoss) {
                updateBoss();
            }
            
            // Verificar miss√µes
            checkMissions();
            
            // Atualizar tempo no modo v√≥rtice para miss√µes
            if (config.players[0].mode === 'vortex') {
                config.vortexTime++;
            }
        };

        // Inicializar novas funcionalidades
        initNewFeatures();

        // =============================================
        // FIM DAS NOVAS ADI√á√ïES
        // =============================================

        // [O resto do seu c√≥digo original permanece EXATAMENTE igual]
        // [...] (Todo o seu c√≥digo original continua aqui)

        // Inicia o jogo
        initParticles();
        updateHealthBar();
        updateXPBar();
        animate();
    </script>
</body>
</html>