<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universo de Partículas PRO Turbo - Edição Definitiva</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            touch-action: manipulation;
            font-family: Arial, sans-serif;
        }

        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        /* [Seus estilos existentes...] */

        /* Novos estilos para a Supernova */
        #supernova-btn {
            position: fixed;
            bottom: 120px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 165, 0, 0.7);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 0 15px rgba(255, 165, 0, 0.5);
        }

        #supernova-cooldown {
            position: fixed;
            bottom: 110px;
            left: 50%;
            transform: translateX(-50%);
            height: 10px;
            width: 150px;
            background: rgba(0,0,0,0.7);
            z-index: 50;
            border-radius: 5px;
            overflow: hidden;
            display: none;
        }

        #supernova-progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #FFA500, #FF4500);
            transition: width 0.1s;
        }

        @media (max-width: 768px) {
            #supernova-btn {
                bottom: 180px;
                right: 15px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- [Seu HTML existente...] -->

    <!-- Adicionando o botão da Supernova -->
    <div id="supernova-btn" title="Supernova (Shift)">☄️</div>
    <div id="supernova-cooldown">
        <div id="supernova-progress"></div>
    </div>

    <script>
        // [Seu código existente...]

        // Atualizando a configuração para incluir a Supernova
        const config = {
            // [Configurações existentes...]
            supernovaCooldown: 0,
            supernovaMaxCooldown: 180, // 3 segundos
            isSupernovaActive: false,
            supernovaUnlocked: true,
            bigbangUnlocked: false,
            skills: [
                // [Habilidades existentes...]
                { id: 'supernova_power', name: "Supernova+", level: 0, max: 3, effect: "Aumenta poder da Supernova", cost: 3 },
                { id: 'supernova_radius', name: "Raio da Supernova", level: 0, max: 3, effect: "Aumenta raio da Supernova", cost: 2 }
            ]
        };

        // Adicionando carinhas extras para inimigos
        const enemyFaces = [">:['", ">:(", "X_X", ">_<", ":O", "◉_◉", "ಠ_ಠ", "⊙_⊙", "≧◡≦", "◕‿◕", ">:[", ">:]", ">:D", ">:P", ">:S", ">:B"];

        // Função para ativar a Supernova
        function activateSupernova() {
            if (config.supernovaCooldown <= 0 && !config.isSupernovaActive && config.supernovaUnlocked) {
                config.isSupernovaActive = true;

                // Efeito visual
                const supernova = document.createElement('div');
                supernova.style.position = 'fixed';
                supernova.style.left = '0';
                supernova.style.top = '0';
                supernova.style.width = '100%';
                supernova.style.height = '100%';
                supernova.style.background = 'radial-gradient(circle, rgba(255,165,0,0.7) 0%, rgba(255,69,0,0) 70%)';
                supernova.style.zIndex = '1000';
                supernova.style.pointerEvents = 'none';
                supernova.style.opacity = '0';
                supernova.style.transition = 'opacity 0.5s';
                document.body.appendChild(supernova);

                setTimeout(() => {
                    supernova.style.opacity = '1';
                }, 10);

                setTimeout(() => {
                    supernova.style.opacity = '0';
                    setTimeout(() => supernova.remove(), 500);
                }, 300);

                // Cálculo do poder com bônus de habilidades
                const supernovaPower = 0.7 + config.skills.find(s => s.id === 'supernova_power').level * 0.2;
                const supernovaRadius = 150 + config.skills.find(s => s.id === 'supernova_radius').level * 30;

                // Efeito nos inimigos
                enemies.forEach(enemy => {
                    const dx = enemy.x - (mouse.x || canvas.width/2);
                    const dy = enemy.y - (mouse.y || canvas.height/2);
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < supernovaRadius) {
                        enemy.health -= 5 * supernovaPower;
                        
                        // Empurrar inimigos
                        const force = (supernovaRadius - distance) / supernovaRadius * 15;
                        const angle = Math.atan2(dy, dx);
                        enemy.x += Math.cos(angle) * force;
                        enemy.y += Math.sin(angle) * force;
                    }
                });

                // Efeito nas partículas
                particles.forEach(p => {
                    const dx = p.x - (mouse.x || canvas.width/2);
                    const dy = p.y - (mouse.y || canvas.height/2);
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < supernovaRadius * 1.5) {
                        const force = (supernovaRadius * 1.5 - distance) / (supernovaRadius * 1.5);
                        const angle = Math.atan2(dy, dx);
                        
                        // Mudar cor para tons alaranjados
                        p.color = `hsl(${30 + Math.random() * 30}, 100%, 60%)`;
                        
                        // Aplicar força
                        p.speedX += Math.cos(angle) * force * 10 * supernovaPower;
                        p.speedY += Math.sin(angle) * force * 10 * supernovaPower;
                    }
                });

                // Adicionar partículas novas
                for (let i = 0; i < 50 * supernovaPower; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * supernovaRadius;
                    particles.push({
                        x: (mouse.x || canvas.width/2) + Math.cos(angle) * distance,
                        y: (mouse.y || canvas.height/2) + Math.sin(angle) * distance,
                        size: Math.random() * 4 + 2,
                        color: `hsl(${20 + Math.random() * 40}, 100%, 60%)`,
                        speedX: Math.cos(angle) * (5 + Math.random() * 10) * supernovaPower,
                        speedY: Math.sin(angle) * (5 + Math.random() * 10) * supernovaPower,
                        baseSpeedX: 0,
                        baseSpeedY: 0,
                        life: 100 + Math.random() * 50,
                        trail: []
                    });
                }

                // Fortalecer o Big-Bang
                const bigbangSkill = config.skills.find(s => s.id === 'bigbang_power');
                if (bigbangSkill.level < bigbangSkill.max) {
                    bigbangSkill.level = Math.min(bigbangSkill.level + 0.3, bigbangSkill.max);
                    showUnlockMessage("Big-Bang fortalecido pela Supernova!");
                }

                setTimeout(() => {
                    config.isSupernovaActive = false;
                    config.supernovaCooldown = config.supernovaMaxCooldown;
                    document.getElementById('supernova-cooldown').style.display = 'block';
                }, 1000);
            }
        }

        // Atualizando o sistema de Big-Bang para desbloquear a cada 15 níveis
        function activateBigBang() {
            if (config.bigBangCooldown <= 0 && !config.isBigBangActive && config.bigbangUnlocked) {
                // [Código existente do Big-Bang...]
                
                // Aplicar bônus da Supernova
                const bigbangPower = 1 + config.skills.find(s => s.id === 'bigbang_power').level * 0.5;
                
                // Efeitos visuais aprimorados
                const colors = ['#FF00FF', '#00FFFF', '#FF00FF', '#00FFFF', '#FF00FF'];
                for (let i = 0; i < 300 * bigbangPower; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 15 * bigbangPower;
                    particles.push({
                        x: mouse.x || canvas.width/2,
                        y: mouse.y || canvas.height/2,
                        size: Math.random() * 6 + 3,
                        color: colors[i % colors.length],
                        speedX: Math.cos(angle) * speed,
                        speedY: Math.sin(angle) * speed,
                        baseSpeedX: 0,
                        baseSpeedY: 0,
                        life: 150 + Math.random() * 100,
                        trail: []
                    });
                }
                
                // [Restante do código do Big-Bang...]
            }
        }

        // Atualizando o sistema de níveis para desbloquear o Big-Bang
        function addXP(amount) {
            config.xp += amount * (1 + Math.sqrt(config.level) * 0.15);
            const maxXP = 100 + (config.level * 30);

            if (config.xp >= maxXP) {
                config.xp -= maxXP;
                config.level++;
                
                // Desbloquear Big-Bang a cada 15 níveis
                if (config.level % 15 === 0 && !config.bigbangUnlocked) {
                    config.bigbangUnlocked = true;
                    showUnlockMessage("Habilidade Big-Bang desbloqueada!");
                    document.getElementById('bigbang-btn').style.display = 'flex';
                }
                
                // [Restante do código de level up...]
            }
            updateXPBar();
        }

        // Atualizando o cooldown da Supernova
        function updateSupernovaCooldown() {
            if (config.supernovaCooldown > 0) {
                config.supernovaCooldown--;
                const percent = (1 - (config.supernovaCooldown / config.supernovaMaxCooldown)) * 100;
                document.getElementById('supernova-progress').style.width = `${percent}%`;
                
                if (config.supernovaCooldown <= 0) {
                    document.getElementById('supernova-cooldown').style.display = 'none';
                }
            }
        }

        // Adicionando listener para a Supernova
        document.getElementById('supernova-btn').addEventListener('click', activateSupernova);
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Shift' && config.supernovaUnlocked) {
                activateSupernova();
            }
        });

        // Atualizando o game loop para incluir a Supernova
        function animate() {
            updateFPSCounter();
            updateBigBangCooldown();
            updateSupernovaCooldown();
            
            // [Restante do game loop...]
        }

        // Inicialização
        function init() {
            // Mostrar apenas o botão da Supernova inicialmente
            document.getElementById('bigbang-btn').style.display = 'none';
            document.getElementById('supernova-cooldown').style.display = 'none';
            
            // [Restante da inicialização...]
        }

        init();
    </script>
</body>
</html>